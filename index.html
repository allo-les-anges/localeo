<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Localeo — Mobile Mock-up (Swipe)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { inter: ['Inter','system-ui','-apple-system','Segoe UI','Roboto','Helvetica','Arial','sans-serif'] },
          colors: {
            brand: { ink:'#0F172A', mint:'#22C55E', mintSoft:'#E8F8EE', violet:'#7C3AED' }
          },
          boxShadow: { soft:'0 10px 30px rgba(15,23,42,0.08)', card:'0 12px 30px rgba(124,58,237,0.12)' }
        }
      }
    }
  </script>
  <style>
    html,body{font-family:'Inter',sans-serif; background:#f6f8fb}
    .app {max-width:420px; margin:0 auto}
    .safe-bottom{padding-bottom:env(safe-area-inset-bottom)}
    .safe-top{padding-top:env(safe-area-inset-top)}
    .deck{position:relative; perspective:1000px; height:68vh; min-height:520px}
    .card{position:absolute; inset:0; border-radius:24px; background:#fff; box-shadow:0 16px 40px rgba(15,23,42,.15); touch-action:pan-y; user-select:none; will-change:transform}
    .card.next{transform:scale(.98) translateY(10px); opacity:.9}
    .like, .nope{position:absolute; top:16px; padding:6px 12px; font-weight:800; border-radius:12px; letter-spacing:.06em; pointer-events:none; transform:rotate(-8deg); opacity:0}
    .like{left:16px; color:#10B981; border:2px solid #10B981; background:rgba(16,185,129,.08)}
    .nope{right:16px; color:#EF4444; border:2px solid #EF4444; background:rgba(239,68,68,.08); transform:rotate(8deg)}
    .imgBlock{border-radius:18px; overflow:hidden; background:linear-gradient(135deg,#e9eef9,#f5f0ff)}
    .badge{font-size:11px; padding:4px 8px; border-radius:9999px; background:#F1F5F9; color:#334155; font-weight:600}
    .tab-active{color:#0F172A}
    .btn{transition:transform .15s ease, opacity .15s ease}
    .btn:active{transform:scale(.96)}
    .modal{position:fixed; inset:0; display:none; z-index:50}
    .modal.show{display:block}
    .mapWrap{height:60vh; min-height:440px}
    .dropzone{border:2px dashed #e2e8f0}
    .dropzone.dragover{border-color:#7C3AED; background:#F5F3FF}
    .shadow-top{box-shadow:0 -8px 24px rgba(15,23,42,.08)}
  </style>
</head>
<body class="app min-h-screen text-slate-800">
  <!-- Top bar -->
  <header class="safe-top sticky top-0 z-40 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="px-4 h-14 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-gradient-to-tr from-brand.violet to-brand.mint flex items-center justify-center shadow-card">
          <span class="text-white font-extrabold text-sm">L</span>
        </div>
        <div class="leading-tight">
          <div class="font-extrabold text-slate-900 text-base">Localeo</div>
          <div class="text-[10px] text-slate-500" data-i18n="tagline">Swipe your next home</div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="btnFilters" class="px-3 py-1.5 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm btn" title="Filtres">
          <span data-i18n="filters">Filtres</span>
        </button>
        <div class="relative">
          <button id="btnLang" class="w-9 h-9 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center btn" title="Langue">
            <svg class="w-5 h-5 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="12" cy="12" r="9" stroke-width="1.5"/>
              <path d="M3 12h18M12 3a15 15 0 010 18M12 3a15 15 0 000 18" stroke-width="1.5"/>
            </svg>
          </button>
          <div id="langMenu" class="hidden absolute right-0 mt-2 w-40 bg-white border border-slate-200 rounded-xl shadow-soft p-1">
            <button data-lang="auto" class="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-50 text-sm">Auto</button>
            <button data-lang="en" class="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-50 text-sm">English</button>
            <button data-lang="es" class="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-50 text-sm">Español</button>
            <button data-lang="fr" class="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-50 text-sm">Français</button>
            <button data-lang="nl" class="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-50 text-sm">Nederlands</button>
            <button data-lang="de" class="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-50 text-sm">Deutsch</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Views -->
  <main class="px-4 pt-4 pb-28">
    <!-- Onboarding / Profile (Demo, no passwords) -->
    <section id="viewOnboarding" class="space-y-4">
      <div class="rounded-2xl p-4 bg-white shadow-soft">
        <h1 class="text-xl font-extrabold text-slate-900" data-i18n="welcome_title">Bienvenue sur Localeo</h1>
        <p class="text-slate-600 mt-1 text-sm" data-i18n="welcome_sub">Créez un profil démo et commencez à swiper des biens.</p>
        <div class="mt-4 grid grid-cols-2 gap-2">
          <button class="typeBtn px-3 py-2 rounded-xl border border-slate-200 hover:bg-slate-50" data-type="individual" data-i18n="type_ind">Particulier</button>
          <button class="typeBtn px-3 py-2 rounded-xl border border-slate-200 hover:bg-slate-50" data-type="agent" data-i18n="type_agent">Agent / Agence</button>
        </div>
        <form id="formProfile" class="mt-4 space-y-3">
          <div>
            <label class="block text-sm text-slate-700 mb-1" data-i18n="label_name">Nom / Organisation</label>
            <input name="name" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-violet-200" required/>
          </div>
          <div>
            <label class="block text-sm text-slate-700 mb-1" data-i18n="label_email">Email (démo)</label>
            <input name="email" type="email" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-violet-200" placeholder="ex: you@domain.com"/>
          </div>
          <div class="rounded-lg bg-slate-50 p-3 text-xs text-slate-600" data-i18n="demo_note">
            Démo: pas d’authentification réelle. Google Sheets sera branché plus tard.
          </div>
          <button class="w-full px-4 py-3 rounded-xl text-white font-semibold bg-gradient-to-tr from-brand.violet to-brand.mint shadow-card btn" data-i18n="start_swiping">
            Démarrer le swipe
          </button>
        </form>
      </div>
      <div class="rounded-2xl p-4 bg-white border border-slate-200 text-xs text-slate-600">
        <div class="font-semibold mb-1" data-i18n="sheet_info_title">Google Sheets (démo)</div>
        <ul class="list-disc pl-4 space-y-1">
          <li data-i18n="sheet_info_offers">Offres (biens): ID, Titre, Prix, Lieu, Surface, Type, Photos</li>
          <li data-i18n="sheet_info_users">Utilisateurs: ID, Nom, Email, Type</li>
        </ul>
        <div class="mt-2 flex gap-2">
          <button id="openSheets" class="px-3 py-2 rounded-lg bg-white border border-slate-200 hover:bg-slate-50 text-sm btn" data-i18n="open_sheets">Ouvrir Sheets</button>
        </div>
      </div>
    </section>

    <!-- Swipe -->
    <section id="viewSwipe" class="hidden">
      <div id="deck" class="deck">
        <!-- cards injected -->
      </div>
      <div class="mt-4 flex justify-center gap-4">
        <button id="btnNope" class="w-14 h-14 rounded-full bg-white border border-slate-200 shadow-soft flex items-center justify-center btn" aria-label="Nope">
          <svg class="w-6 h-6 text-rose-500" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        <button id="btnInfo" class="w-14 h-14 rounded-full bg-white border border-slate-200 shadow-soft flex items-center justify-center btn" aria-label="Info">
          <svg class="w-6 h-6 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="9" stroke-width="2"/>
            <path d="M12 8v.01M12 12v4" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <button id="btnLike" class="w-14 h-14 rounded-full bg-gradient-to-tr from-brand.violet to-brand.mint text-white shadow-card flex items-center justify-center btn" aria-label="Like">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M11.99 21s-6.715-4.35-9.49-7.784C-0.28 9.9 1.22 5.7 4.89 5.1c2.13-.35 4.07.82 5.1 2.27 1.03-1.45 2.97-2.62 5.1-2.27 3.67.6 5.17 4.8 1.39 8.116C18.7 16.65 11.99 21 11.99 21z"/></svg>
        </button>
      </div>
    </section>

    <!-- Favorites -->
    <section id="viewFav" class="hidden">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold" data-i18n="favorites">Favoris</h2>
        <button id="btnClearFav" class="text-sm px-3 py-1.5 rounded-lg bg-slate-100 hover:bg-slate-200 btn" data-i18n="clear">Tout effacer</button>
      </div>
      <div id="favList" class="grid grid-cols-1 gap-3"></div>
      <div id="favEmpty" class="rounded-xl bg-white border border-slate-200 p-4 text-center text-sm text-slate-600 mt-3 hidden" data-i18n="no_fav">Aucun favori pour le moment.</div>
    </section>

    <!-- Add Listing -->
    <section id="viewAdd" class="hidden space-y-3">
      <div class="rounded-2xl p-4 bg-white shadow-soft">
        <h2 class="text-lg font-semibold" data-i18n="add_listing">Mettre en ligne un bien</h2>
        <form id="formAdd" class="mt-3 space-y-3">
          <div>
            <label class="block text-sm mb-1" data-i18n="label_title">Titre</label>
            <input name="title" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-violet-200" required/>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="block text-sm mb-1" data-i18n="label_price">Prix (€)</label>
              <input name="price" type="number" min="0" step="1000" class="w-full px-3 py-2 rounded-lg border border-slate-200" required/>
            </div>
            <div>
              <label class="block text-sm mb-1" data-i18n="label_surface">Surface (m²)</label>
              <input name="surface" type="number" min="0" step="1" class="w-full px-3 py-2 rounded-lg border border-slate-200" required/>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="block text-sm mb-1" data-i18n="label_location">Lieu</label>
              <input name="location" class="w-full px-3 py-2 rounded-lg border border-slate-200" placeholder="ex: Marseille" required/>
            </div>
            <div>
              <label class="block text-sm mb-1" data-i18n="label_type">Type</label>
              <select name="ptype" class="w-full px-3 py-2 rounded-lg border border-slate-200">
                <option value="apartment" data-i18n="type_apartment">Appartement</option>
                <option value="house" data-i18n="type_house">Maison</option>
                <option value="studio" data-i18n="type_studio">Studio</option>
              </select>
            </div>
          </div>
          <div>
            <label class="block text-sm mb-1" data-i18n="label_desc">Description</label>
            <textarea name="desc" rows="3" class="w-full px-3 py-2 rounded-lg border border-slate-200" placeholder=""></textarea>
          </div>

          <div>
            <label class="block text-sm mb-2" data-i18n="label_photos">Photos (aperçu — démo)</label>
            <div id="dropzone" class="dropzone rounded-xl bg-slate-50 p-3 text-sm text-slate-600">
              <div class="flex items-center justify-between gap-2">
                <div>
                  <span data-i18n="photo_hint">Glissez-déposez ou</span>
                  <button type="button" id="chooseFiles" class="text-brand.violet font-semibold underline underline-offset-2 ml-1" data-i18n="click_choose">cliquez pour choisir</button>
                  <div class="text-xs text-slate-500" data-i18n="photo_limit">Jusqu’à 3 images (non envoyées).</div>
                </div>
                <input id="fileInput" type="file" accept="image/*" multiple class="hidden">
                <div id="imageCount" class="text-xs px-2 py-1 rounded-md bg-white border border-slate-200">0</div>
              </div>
              <div id="thumbs" class="mt-3 grid grid-cols-3 gap-2"></div>
            </div>
          </div>

          <div class="flex gap-2 pt-1">
            <button class="flex-1 px-4 py-3 rounded-xl text-white font-semibold bg-gradient-to-tr from-brand.violet to-brand.mint shadow-card btn" data-i18n="publish">Publier (démo)</button>
            <button type="button" id="openOffersSheet" class="px-4 py-3 rounded-xl bg-white border border-slate-200 hover:bg-slate-50 btn text-sm" data-i18n="open_offers_sheet">Feuille Offres</button>
          </div>
          <div class="text-xs text-slate-500 mt-2" data-i18n="sheet_disclaimer">Démo: les ajouts sont stockés localement et prêts à être envoyés vers Google Sheets.</div>
        </form>
      </div>
    </section>

    <!-- Map -->
    <section id="viewMap" class="hidden">
      <div class="rounded-2xl p-4 bg-white shadow-soft">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold" data-i18n="map">Carte</h2>
          <button id="btnMapFilter" class="text-sm px-3 py-1.5 rounded-lg bg-slate-100 hover:bg-slate-200 btn" data-i18n="filters">Filtres</button>
        </div>
        <div class="mt-3 mapWrap rounded-xl overflow-hidden border border-slate-200 bg-slate-50 relative">
          <svg id="mapSVG" viewBox="0 0 360 260" class="w-full h-full">
            <rect x="0" y="0" width="360" height="260" fill="#f8fafc"/>
            <!-- simple blob land -->
            <path d="M20,160 C60,60 200,20 320,80 C360,160 300,220 200,240 C100,260 40,230 20,160 Z" fill="#e2e8f0"/>
          </svg>
          <div class="absolute left-2 bottom-2 text-[10px] text-slate-500 px-2 py-1 rounded bg-white/80 border border-slate-200" data-i18n="map_demo">Vue carte démo (sans tuiles)</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav class="safe-bottom fixed bottom-0 inset-x-0 z-40 bg-white border-t border-slate-200 shadow-top">
    <div class="px-6 py-2 grid grid-cols-4 gap-2 text-slate-500">
      <button class="tab tab-active flex flex-col items-center gap-1 py-1" data-tab="swipe">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21c4.418 0 8-2.91 8-6.5S16.418 8 12 8 4 10.91 4 14.5 7.582 21 12 21z"/><circle cx="12" cy="7" r="3"/></svg>
        <span class="text-[11px]" data-i18n="tab_swipe">Swipe</span>
      </button>
      <button class="tab flex flex-col items-center gap-1 py-1" data-tab="fav">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21s-6.5-4.2-9.2-7.5C-0.2 10 1.3 6 5 5.4c2.1-.3 4 .8 5 2.2 1-1.4 2.9-2.5 5-2.2 3.7.6 5.2 4.6 2.2 8.1C18.5 16.8 12 21 12 21z"/></svg>
        <span class="text-[11px]" data-i18n="tab_fav">Favoris</span>
      </button>
      <button class="tab flex flex-col items-center gap-1 py-1" data-tab="add">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></svg>
        <span class="text-[11px]" data-i18n="tab_add">Ajouter</span>
      </button>
      <button class="tab flex flex-col items-center gap-1 py-1" data-tab="map">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M9 18l-6 3V6l6-3 6 3 6-3v15l-6 3-6-3zM9 5.5v12l6 3v-12l-6-3z"/></svg>
        <span class="text-[11px]" data-i18n="tab_map">Carte</span>
      </button>
    </div>
  </nav>

  <!-- Filters Modal -->
  <div id="filtersModal" class="modal">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute bottom-0 inset-x-0 bg-white rounded-t-2xl p-4 shadow-top">
      <div class="flex items-center justify-between">
        <div class="font-semibold" data-i18n="filters">Filtres</div>
        <button id="closeFilters" class="w-9 h-9 rounded-lg bg-slate-100 flex items-center justify-center">
          <svg class="w-5 h-5 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" stroke-linecap="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="formFilters" class="mt-3 space-y-3">
        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm mb-1" data-i18n="min_price">Prix min</label>
            <input name="minPrice" type="number" min="0" step="10000" class="w-full px-3 py-2 rounded-lg border border-slate-200" placeholder="0">
          </div>
          <div>
            <label class="block text-sm mb-1" data-i18n="max_price">Prix max</label>
            <input name="maxPrice" type="number" min="0" step="10000" class="w-full px-3 py-2 rounded-lg border border-slate-200" placeholder="∞">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm mb-1" data-i18n="min_surface">Surface min (m²)</label>
            <input name="minSurface" type="number" min="0" step="1" class="w-full px-3 py-2 rounded-lg border border-slate-200" placeholder="0">
          </div>
          <div>
            <label class="block text-sm mb-1" data-i18n="type">Type</label>
            <select name="ptype" class="w-full px-3 py-2 rounded-lg border border-slate-200">
              <option value="" data-i18n="any">Tous</option>
              <option value="apartment" data-i18n="type_apartment">Appartement</option>
              <option value="house" data-i18n="type_house">Maison</option>
              <option value="studio" data-i18n="type_studio">Studio</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm mb-1" data-i18n="location">Lieu</label>
          <input name="location" class="w-full px-3 py-2 rounded-lg border border-slate-200" placeholder="Paris, Lyon…">
        </div>
        <div class="flex gap-2 pt-1">
          <button class="flex-1 px-4 py-3 rounded-xl text-white font-semibold bg-gradient-to-tr from-brand.violet to-brand.mint btn" data-i18n="apply">Appliquer</button>
          <button type="button" id="resetFilters" class="px-4 py-3 rounded-xl bg-white border border-slate-200 btn" data-i18n="reset">Réinitialiser</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Details Modal -->
  <div id="detailsModal" class="modal">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute bottom-0 inset-x-0 bg-white rounded-t-2xl p-4 shadow-top">
      <div class="flex items-center justify-between">
        <div class="font-semibold">Localeo</div>
        <button id="closeDetails" class="w-9 h-9 rounded-lg bg-slate-100 flex items-center justify-center">
          <svg class="w-5 h-5 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" stroke-linecap="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="detailsBody" class="mt-3 space-y-3">
        <!-- filled dynamically -->
      </div>
      <div class="flex gap-2 pt-1">
        <button id="detailsLike" class="flex-1 px-4 py-3 rounded-xl text-white font-semibold bg-gradient-to-tr from-brand.violet to-brand.mint btn" data-i18n="save_fav">Ajouter aux favoris</button>
        <button id="detailsNext" class="px-4 py-3 rounded-xl bg-white border border-slate-200 btn" data-i18n="next">Suivant</button>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toasts" class="fixed top-3 right-3 z-[60] space-y-2"></div>

  <script>
    // i18n
    const I18N = {
      en:{ tagline:'Swipe your next home', welcome_title:'Welcome to Localeo', welcome_sub:'Create a demo profile and start swiping homes.',
        type_ind:'Individual', type_agent:'Agent / Agency', label_name:'Name / Organization', label_email:'Email (demo)',
        demo_note:'Demo only — no real authentication. Google Sheets will be connected later.',
        start_swiping:'Start swiping', sheet_info_title:'Google Sheets (demo)', sheet_info_offers:'Offers: ID, Title, Price, City, Area, Type, Photos',
        sheet_info_users:'Users: ID, Name, Email, Type', open_sheets:'Open Sheets', filters:'Filters', favorites:'Favorites',
        clear:'Clear all', add_listing:'Post a listing', label_title:'Title', label_price:'Price (€)', label_surface:'Area (sqm)', label_location:'City', label_type:'Type', label_desc:'Description',
        label_photos:'Photos (preview — demo)', photo_hint:'Drag & drop or', click_choose:'click to choose', photo_limit:'Up to 3 images (not uploaded).',
        publish:'Publish (demo)', open_offers_sheet:'Offers Sheet', sheet_disclaimer:'Demo: items are stored locally and ready for Google Sheets.',
        map:'Map', map_demo:'Demo map (no tiles)', tab_swipe:'Swipe', tab_fav:'Saved', tab_add:'Post', tab_map:'Map',
        min_price:'Min price', max_price:'Max price', min_surface:'Min area', type:'Type', any:'Any', location:'City', apply:'Apply', reset:'Reset',
        save_fav:'Save to favorites', next:'Next', no_fav:'No favorites yet.' ,
        type_apartment:'Apartment', type_house:'House', type_studio:'Studio'
      },
      es:{ tagline:'Encuentra tu hogar deslizando', welcome_title:'Bienvenido a Localeo', welcome_sub:'Crea un perfil demo y empieza a deslizar.',
        type_ind:'Particular', type_agent:'Agente / Agencia', label_name:'Nombre / Organización', label_email:'Email (demo)',
        demo_note:'Demo — sin autenticación real. Google Sheets se conectará más tarde.',
        start_swiping:'Empezar a deslizar', sheet_info_title:'Google Sheets (demo)', sheet_info_offers:'Ofertas: ID, Título, Precio, Ciudad, Superficie, Tipo, Fotos',
        sheet_info_users:'Usuarios: ID, Nombre, Email, Tipo', open_sheets:'Abrir Sheets', filters:'Filtros', favorites:'Favoritos',
        clear:'Borrar todo', add_listing:'Publicar anuncio', label_title:'Título', label_price:'Precio (€)', label_surface:'Superficie (m²)', label_location:'Ciudad', label_type:'Tipo', label_desc:'Descripción',
        label_photos:'Fotos (vista previa — demo)', photo_hint:'Arrastra y suelta o', click_choose:'haz clic para elegir', photo_limit:'Hasta 3 imágenes (no subidas).',
        publish:'Publicar (demo)', open_offers_sheet:'Hoja Ofertas', sheet_disclaimer:'Demo: se guarda localmente listo para Google Sheets.',
        map:'Mapa', map_demo:'Mapa demo (sin tiles)', tab_swipe:'Swipe', tab_fav:'Guardados', tab_add:'Publicar', tab_map:'Mapa',
        min_price:'Precio mín', max_price:'Precio máx', min_surface:'Superficie mín', type:'Tipo', any:'Cualquiera', location:'Ciudad', apply:'Aplicar', reset:'Restablecer',
        save_fav:'Guardar en favoritos', next:'Siguiente', no_fav:'Sin favoritos aún.',
        type_apartment:'Apartamento', type_house:'Casa', type_studio:'Estudio'
      },
      fr:{ tagline:'Swipez votre prochain chez-vous', welcome_title:'Bienvenue sur Localeo', welcome_sub:'Créez un profil démo et commencez à swiper des biens.',
        type_ind:'Particulier', type_agent:'Agent / Agence', label_name:'Nom / Organisation', label_email:'Email (démo)',
        demo_note:'Démo — pas d’authentification réelle. Google Sheets sera branché plus tard.',
        start_swiping:'Démarrer le swipe', sheet_info_title:'Google Sheets (démo)', sheet_info_offers:'Offres : ID, Titre, Prix, Ville, Surface, Type, Photos',
        sheet_info_users:'Utilisateurs : ID, Nom, Email, Type', open_sheets:'Ouvrir Sheets', filters:'Filtres', favorites:'Favoris',
        clear:'Tout effacer', add_listing:'Mettre en ligne un bien', label_title:'Titre', label_price:'Prix (€)', label_surface:'Surface (m²)', label_location:'Lieu', label_type:'Type', label_desc:'Description',
        label_photos:'Photos (aperçu — démo)', photo_hint:'Glissez-déposez ou', click_choose:'cliquez pour choisir', photo_limit:'Jusqu’à 3 images (non envoyées).',
        publish:'Publier (démo)', open_offers_sheet:'Feuille Offres', sheet_disclaimer:'Démo : ajouté localement, prêt pour Google Sheets.',
        map:'Carte', map_demo:'Vue carte démo (sans tuiles)', tab_swipe:'Swipe', tab_fav:'Favoris', tab_add:'Ajouter', tab_map:'Carte',
        min_price:'Prix min', max_price:'Prix max', min_surface:'Surface min', type:'Type', any:'Tous', location:'Lieu', apply:'Appliquer', reset:'Réinitialiser',
        save_fav:'Ajouter aux favoris', next:'Suivant', no_fav:'Aucun favori pour le moment.',
        type_apartment:'Appartement', type_house:'Maison', type_studio:'Studio'
      },
      nl:{ tagline:'Swipe naar je volgende huis', welcome_title:'Welkom bij Localeo', welcome_sub:'Maak een demoprofiel en begin te swipen.',
        type_ind:'Particulier', type_agent:'Makelaar / Kantoor', label_name:'Naam / Organisatie', label_email:'E-mail (demo)',
        demo_note:'Demo — geen echte authenticatie. Google Sheets komt later.',
        start_swiping:'Start swipen', sheet_info_title:'Google Sheets (demo)', sheet_info_offers:'Aanbod: ID, Titel, Prijs, Stad, Oppervlakte, Type, Foto’s',
        sheet_info_users:'Gebruikers: ID, Naam, E-mail, Type', open_sheets:'Sheets openen', filters:'Filters', favorites:'Favorieten',
        clear:'Alles wissen', add_listing:'Woning plaatsen', label_title:'Titel', label_price:'Prijs (€)', label_surface:'Oppervlakte (m²)', label_location:'Plaats', label_type:'Type', label_desc:'Beschrijving',
        label_photos:'Foto’s (preview — demo)', photo_hint:'Sleep & zet neer of', click_choose:'klik om te kiezen', photo_limit:'Max 3 foto’s (niet geüpload).',
        publish:'Publiceren (demo)', open_offers_sheet:'Aanbod-sheet', sheet_disclaimer:'Demo: lokaal opgeslagen, klaar voor Google Sheets.',
        map:'Kaart', map_demo:'Demokaart (zonder tiles)', tab_swipe:'Swipe', tab_fav:'Favorieten', tab_add:'Plaatsen', tab_map:'Kaart',
        min_price:'Min prijs', max_price:'Max prijs', min_surface:'Min opp.', type:'Type', any:'Alle', location:'Plaats', apply:'Toepassen', reset:'Resetten',
        save_fav:'Opslaan als favoriet', next:'Volgende', no_fav:'Nog geen favorieten.',
        type_apartment:'Appartement', type_house:'Huis', type_studio:'Studio'
      },
      de:{ tagline:'Wische zu deinem nächsten Zuhause', welcome_title:'Willkommen bei Localeo', welcome_sub:'Erstelle ein Demoprofil und beginne zu wischen.',
        type_ind:'Privat', type_agent:'Makler / Agentur', label_name:'Name / Organisation', label_email:'E-Mail (Demo)',
        demo_note:'Demo — keine echte Anmeldung. Google Sheets folgt später.',
        start_swiping:'Jetzt wischen', sheet_info_title:'Google Sheets (Demo)', sheet_info_offers:'Angebote: ID, Titel, Preis, Stadt, Fläche, Typ, Fotos',
        sheet_info_users:'Nutzer: ID, Name, E-Mail, Typ', open_sheets:'Sheets öffnen', filters:'Filter', favorites:'Favoriten',
        clear:'Alle löschen', add_listing:'Anzeige erstellen', label_title:'Titel', label_price:'Preis (€)', label_surface:'Fläche (m²)', label_location:'Ort', label_type:'Typ', label_desc:'Beschreibung',
        label_photos:'Fotos (Vorschau — Demo)', photo_hint:'Ziehen & ablegen oder', click_choose:'zum Auswählen klicken', photo_limit:'Bis zu 3 Bilder (nicht hochgeladen).',
        publish:'Veröffentlichen (Demo)', open_offers_sheet:'Angebotsblatt', sheet_disclaimer:'Demo: lokal gespeichert, bereit für Google Sheets.',
        map:'Karte', map_demo:'Demo-Karte (ohne Tiles)', tab_swipe:'Swipe', tab_fav:'Gespeichert', tab_add:'Erstellen', tab_map:'Karte',
        min_price:'Min Preis', max_price:'Max Preis', min_surface:'Min Fläche', type:'Typ', any:'Alle', location:'Ort', apply:'Übernehmen', reset:'Zurücksetzen',
        save_fav:'Zu Favoriten', next:'Weiter', no_fav:'Noch keine Favoriten.',
        type_apartment:'Wohnung', type_house:'Haus', type_studio:'Studio'
      }
    };
    let lang = localStorage.getItem('localeo_lang') || 'auto';
    function detectLang(){
      if (lang!=='auto') return lang;
      const n = (navigator.language||'en').slice(0,2);
      return ['en','es','fr','nl','de'].includes(n) ? n : 'en';
    }
    function t(key){
      const L = I18N[detectLang()] || I18N.en;
      return L[key] || I18N.en[key] || key;
    }
    function applyI18n(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{ el.textContent = t(el.getAttribute('data-i18n')); });
      // placeholders where helpful
      const place = {
        label_location:'placeholder', label_title:'placeholder', label_desc:'placeholder'
      };
      // Simple optional placeholders
    }

    // Toast
    const toastWrap = document.getElementById('toasts');
    function toast(msg, type='ok'){
      const el = document.createElement('div');
      el.className = `px-3 py-2 rounded-lg text-white text-sm shadow-soft ${type==='err'?'bg-rose-500':'bg-slate-900'}`;
      el.textContent = msg;
      toastWrap.appendChild(el);
      setTimeout(()=>el.remove(), 2600);
    }

    // Demo data (images: SVG blocks)
    const props = [];
    const liked = new Set(JSON.parse(localStorage.getItem('localeo_liked')||'[]'));
    const hidden = new Set(JSON.parse(localStorage.getItem('localeo_hidden')||'[]')); // passed (left)
    let currentDeck = [];
    let deckIndex = 0;

    function seed(){
      const sample = [
        {id:'P1', title:'T2 plein centre', price:185000, location:'Marseille', surface:52, ptype:'apartment', lat:43.3, lng:5.37, desc:'Lumineux, proche Vieux-Port.'},
        {id:'P2', title:'Maison familiale', price:349000, location:'Lyon', surface:95, ptype:'house', lat:45.76, lng:4.84, desc:'Jardin et garage.'},
        {id:'P3', title:'Studio cosy', price:210000, location:'Paris', surface:28, ptype:'studio', lat:48.85, lng:2.35, desc:'Idéal investisseur, Quartier 11e.'},
        {id:'P4', title:'Loft vue Garonne', price:420000, location:'Bordeaux', surface:70, ptype:'apartment', lat:44.84, lng:-0.58, desc:'Terrasse, rénové.'},
        {id:'P5', title:'Villa colline', price:780000, location:'Nice', surface:130, ptype:'house', lat:43.7, lng:7.27, desc:'Vue mer, piscine.'},
        {id:'P6', title:'Canal appartement', price:520000, location:'Amsterdam', surface:68, ptype:'apartment', lat:52.37, lng:4.9, desc:'Charme et lumière.'}
      ];
      if (props.length===0) props.push(...sample);
    }

    // Profile (demo)
    let profile = JSON.parse(localStorage.getItem('localeo_profile')||'null');

    // Views / Tabs
    const viewOnboarding = document.getElementById('viewOnboarding');
    const viewSwipe = document.getElementById('viewSwipe');
    const viewFav = document.getElementById('viewFav');
    const viewAdd = document.getElementById('viewAdd');
    const viewMap = document.getElementById('viewMap');

    function showView(which){
      [viewOnboarding,viewSwipe,viewFav,viewAdd,viewMap].forEach(v=>v.classList.add('hidden'));
      if (which==='onboarding') viewOnboarding.classList.remove('hidden');
      if (which==='swipe') viewSwipe.classList.remove('hidden');
      if (which==='fav') viewFav.classList.remove('hidden');
      if (which==='add') viewAdd.classList.remove('hidden');
      if (which==='map') viewMap.classList.remove('hidden');
      // refresh contextual UIs
      if (which==='swipe') renderDeck();
      if (which==='fav') renderFav();
      if (which==='map') renderMap();
    }

    // Bottom tabs
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('tab-active','text-brand.ink'));
        btn.classList.add('tab-active','text-brand.ink');
        const tab = btn.getAttribute('data-tab');
        if (!profile){ showView('onboarding'); return; }
        if (tab==='swipe') showView('swipe');
        if (tab==='fav') showView('fav');
        if (tab==='add') showView('add');
        if (tab==='map') showView('map');
      });
    });

    // Top bar: language
    const btnLang = document.getElementById('btnLang');
    const langMenu = document.getElementById('langMenu');
    btnLang.addEventListener('click', ()=> langMenu.classList.toggle('hidden'));
    langMenu.querySelectorAll('button').forEach(b=>{
      b.addEventListener('click', ()=>{
        lang = b.getAttribute('data-lang');
        localStorage.setItem('localeo_lang', lang);
        langMenu.classList.add('hidden');
        applyI18n();
        toast('Langue mise à jour');
      });
    });

    // Open Sheets links
    document.getElementById('openSheets').addEventListener('click', ()=> window.open('https://docs.google.com/spreadsheets/', '_blank', 'noopener,noreferrer'));
    document.getElementById('openOffersSheet').addEventListener('click', ()=> window.open('https://docs.google.com/spreadsheets/', '_blank', 'noopener,noreferrer'));

    // Onboarding actions
    let pickedType = 'individual';
    document.querySelectorAll('.typeBtn').forEach(b=>{
      b.addEventListener('click', ()=>{
        pickedType = b.getAttribute('data-type') || 'individual';
        document.querySelectorAll('.typeBtn').forEach(x=>x.classList.remove('bg-slate-100'));
        b.classList.add('bg-slate-100');
      });
    });
    document.getElementById('formProfile').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const name = (fd.get('name')||'').trim();
      const email = (fd.get('email')||'').trim();
      if (!name){ toast('Indiquez un nom.', 'err'); return; }
      profile = { id:'U'+Date.now(), name, email, type:pickedType };
      localStorage.setItem('localeo_profile', JSON.stringify(profile));
      toast('Profil démo créé ✅');
      buildDeck();
      showView('swipe');
    });

    // Filters
    const filtersModal = document.getElementById('filtersModal');
    document.getElementById('btnFilters').addEventListener('click', ()=> filtersModal.classList.add('show'));
    document.getElementById('btnMapFilter').addEventListener('click', ()=> filtersModal.classList.add('show'));
    document.getElementById('closeFilters').addEventListener('click', ()=> filtersModal.classList.remove('show'));
    filtersModal.addEventListener('click', (e)=>{ if (e.target===filtersModal) filtersModal.classList.remove('show'); });

    let filters = { minPrice:null, maxPrice:null, minSurface:null, ptype:'', location:'' };
    document.getElementById('formFilters').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      filters = {
        minPrice: Number(fd.get('minPrice')||0) || null,
        maxPrice: Number(fd.get('maxPrice')||0) || null,
        minSurface: Number(fd.get('minSurface')||0) || null,
        ptype: (fd.get('ptype')||''),
        location: (fd.get('location')||'').trim()
      };
      filtersModal.classList.remove('show');
      buildDeck();
      renderMap();
      toast('Filtres appliqués');
    });
    document.getElementById('resetFilters').addEventListener('click', ()=>{
      filters = { minPrice:null, maxPrice:null, minSurface:null, ptype:'', location:'' };
      document.getElementById('formFilters').reset();
      buildDeck();
      renderMap();
      toast('Filtres réinitialisés');
    });

    // Build deck by filters, excluding hidden
    function applyFilters(list){
      return list.filter(p=>{
        if (filters.minPrice && p.price < filters.minPrice) return false;
        if (filters.maxPrice && p.price > filters.maxPrice) return false;
        if (filters.minSurface && p.surface < filters.minSurface) return false;
        if (filters.ptype && p.ptype !== filters.ptype) return false;
        if (filters.location && !p.location.toLowerCase().includes(filters.location.toLowerCase())) return false;
        return true;
      });
    }
    function buildDeck(){
      const base = applyFilters(props).filter(p=> !hidden.has(p.id));
      currentDeck = base;
      deckIndex = 0;
      renderDeck();
    }

    // Deck rendering + swipe
    const deck = document.getElementById('deck');
    let currentCardEl = null;
    let nextCardEl = null;

    function cardHTML(p){
      const typeLabel = t('type_'+p.ptype) || p.ptype;
      // pseudo-image
      const colors = [['#dbeafe','#e9d5ff'],['#fee2e2','#d1fae5'],['#ede9fe','#cffafe'],['#fde68a','#e9d5ff']];
      const pick = colors[p.id.charCodeAt(0)%colors.length];
      return `
        <div class="like">LIKE</div>
        <div class="nope">NOPE</div>
        <div class="p-3 h-full flex flex-col">
          <div class="imgBlock h-1/2" style="background:linear-gradient(135deg, ${pick[0]}, ${pick[1]});">
            <div class="w-full h-full flex items-center justify-center">
              <svg class="w-24 h-24 text-white/80" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 10l9-7 9 7v10a1 1 0 01-1 1h-5v-6H9v6H4a1 1 0 01-1-1V10z"/>
              </svg>
            </div>
          </div>
          <div class="flex-1 mt-3">
            <div class="flex items-start justify-between gap-2">
              <div class="font-extrabold text-lg text-slate-900">${p.title}</div>
              <div class="text-right font-extrabold text-brand.ink">€ ${Number(p.price).toLocaleString('fr-FR')}</div>
            </div>
            <div class="mt-2 flex flex-wrap gap-1.5">
              <span class="badge">${p.location}</span>
              <span class="badge">${p.surface} m²</span>
              <span class="badge">${typeLabel}</span>
            </div>
            <p class="mt-2 text-sm text-slate-600 line-clamp-3">${p.desc||''}</p>
          </div>
        </div>
      `;
    }

    function renderDeck(){
      deck.innerHTML = '';
      if (!currentDeck.length){
        const empty = document.createElement('div');
        empty.className = 'absolute inset-0 rounded-2xl bg-white border border-slate-200 flex items-center justify-center text-slate-600';
        empty.textContent = 'Plus de biens — ajustez vos filtres.';
        deck.appendChild(empty);
        currentCardEl = null; nextCardEl = null;
        return;
      }
      const cur = currentDeck[deckIndex] || currentDeck[0];
      const next = currentDeck[deckIndex+1];
      const c1 = document.createElement('div');
      c1.className = 'card';
      c1.setAttribute('data-id', cur.id);
      c1.innerHTML = cardHTML(cur);
      deck.appendChild(c1);
      currentCardEl = c1;
      if (next){
        const c2 = document.createElement('div');
        c2.className = 'card next';
        c2.setAttribute('data-id', next.id);
        c2.innerHTML = cardHTML(next);
        deck.appendChild(c2);
        nextCardEl = c2;
      }
      attachSwipe(c1);
    }

    function advanceDeck(){
      deckIndex++;
      if (deckIndex >= currentDeck.length){ renderDeck(); return; }
      renderDeck();
    }

    function attachSwipe(card){
      let startX=0, startY=0, dx=0, dy=0, dragging=false;
      const likeEl = card.querySelector('.like');
      const nopeEl = card.querySelector('.nope');

      function onStart(e){
        dragging = true;
        const t = e.touches ? e.touches[0] : e;
        startX = t.clientX; startY = t.clientY;
        card.style.transition='none';
      }
      function onMove(e){
        if (!dragging) return;
        const t = e.touches ? e.touches[0] : e;
        dx = t.clientX - startX; dy = t.clientY - startY;
        const rot = dx/20;
        card.style.transform = `translate(${dx}px, ${dy}px) rotate(${rot}deg)`;
        const likeA = Math.min(1, Math.max(0, (dx-20)/120));
        const nopeA = Math.min(1, Math.max(0, (-dx-20)/120));
        likeEl.style.opacity = likeA;
        nopeEl.style.opacity = nopeA;
      }
      function onEnd(){
        dragging = false;
        const threshold = 80;
        if (dx > threshold){ doLike(card.getAttribute('data-id')); animateOut('right'); }
        else if (dx < -threshold){ doNope(card.getAttribute('data-id')); animateOut('left'); }
        else {
          card.style.transition='transform .2s ease';
          card.style.transform='translate(0,0) rotate(0)';
          likeEl.style.opacity=0; nopeEl.style.opacity=0;
        }
        function animateOut(dir){
          card.style.transition='transform .25s ease, opacity .25s ease';
          card.style.transform = `translate(${dir==='right'? 500 : -500}px, ${dy}px) rotate(${dir==='right'? 20:-20}deg)`;
          card.style.opacity='0';
          setTimeout(()=> advanceDeck(), 200);
        }
        dx=0; dy=0;
      }
      card.addEventListener('touchstart', onStart, {passive:true});
      card.addEventListener('touchmove', onMove, {passive:true});
      card.addEventListener('touchend', onEnd);
      card.addEventListener('mousedown', onStart);
      window.addEventListener('mousemove', onMove);
      window.addEventListener('mouseup', onEnd);
    }

    // Like / Nope / Info buttons
    document.getElementById('btnLike').addEventListener('click', ()=> {
      const id = currentDeck[deckIndex]?.id; if (!id) return;
      doLike(id);
      animateButtonLike();
      advanceDeck();
    });
    document.getElementById('btnNope').addEventListener('click', ()=> {
      const id = currentDeck[deckIndex]?.id; if (!id) return;
      doNope(id);
      advanceDeck();
    });
    document.getElementById('btnInfo').addEventListener('click', ()=> {
      const p = currentDeck[deckIndex]; if (!p) return;
      openDetails(p);
    });

    function doLike(id){
      liked.add(id);
      localStorage.setItem('localeo_liked', JSON.stringify([...liked]));
      toast('Ajouté aux favoris ✅');
    }
    function doNope(id){
      hidden.add(id);
      localStorage.setItem('localeo_hidden', JSON.stringify([...hidden]));
    }

    function animateButtonLike(){
      // subtle feedback; already enough with toast
    }

    // Details modal
    const detailsModal = document.getElementById('detailsModal');
    const detailsBody = document.getElementById('detailsBody');
    let detailsProp = null;

    function openDetails(p){
      detailsProp = p;
      const typeLabel = t('type_'+p.ptype) || p.ptype;
      detailsBody.innerHTML = `
        <div class="imgBlock h-40 w-full rounded-xl" style="background:linear-gradient(135deg,#dbeafe,#e9d5ff)"></div>
        <div class="flex items-start justify-between mt-2">
          <div>
            <div class="text-lg font-extrabold text-slate-900">${p.title}</div>
            <div class="mt-1 flex gap-1.5">
              <span class="badge">${p.location}</span>
              <span class="badge">${p.surface} m²</span>
              <span class="badge">${typeLabel}</span>
            </div>
          </div>
          <div class="font-extrabold text-brand.ink">€ ${Number(p.price).toLocaleString('fr-FR')}</div>
        </div>
        <p class="text-sm text-slate-700">${p.desc||''}</p>
      `;
      detailsModal.classList.add('show');
    }
    document.getElementById('closeDetails').addEventListener('click', ()=> detailsModal.classList.remove('show'));
    detailsModal.addEventListener('click', (e)=>{ if (e.target===detailsModal) detailsModal.classList.remove('show'); });
    document.getElementById('detailsLike').addEventListener('click', ()=>{
      if (!detailsProp) return;
      doLike(detailsProp.id);
      detailsModal.classList.remove('show');
    });
    document.getElementById('detailsNext').addEventListener('click', ()=>{
      detailsModal.classList.remove('show');
      advanceDeck();
    });

    // Favorites
    function renderFav(){
      const wrap = document.getElementById('favList');
      wrap.innerHTML = '';
      const arr = props.filter(p=> liked.has(p.id));
      document.getElementById('favEmpty').classList.toggle('hidden', arr.length>0);
      arr.forEach(p=>{
        const item = document.createElement('div');
        item.className = 'rounded-xl bg-white border border-slate-200 p-3 flex gap-3';
        item.innerHTML = `
          <div class="w-20 h-16 imgBlock"></div>
          <div class="flex-1">
            <div class="font-semibold text-slate-900">${p.title}</div>
            <div class="text-sm text-slate-600">${p.location} • ${p.surface} m²</div>
            <div class="text-sm font-bold mt-0.5 text-brand.ink">€ ${Number(p.price).toLocaleString('fr-FR')}</div>
            <div class="mt-2 flex gap-2">
              <button class="openDetails px-3 py-1.5 rounded-lg bg-slate-100 hover:bg-slate-200 text-xs" data-id="${p.id}" data-i18n="next">${t('next')}</button>
              <button class="removeFav px-3 py-1.5 rounded-lg bg-white border border-slate-200 text-xs" data-id="${p.id}">Remove</button>
            </div>
          </div>
        `;
        wrap.appendChild(item);
      });
      wrap.querySelectorAll('.removeFav').forEach(b=>{
        b.addEventListener('click', ()=>{
          liked.delete(b.getAttribute('data-id'));
          localStorage.setItem('localeo_liked', JSON.stringify([...liked]));
          renderFav();
          toast('Retiré des favoris');
        });
      });
      wrap.querySelectorAll('.openDetails').forEach(b=>{
        b.addEventListener('click', ()=>{
          const p = props.find(x=> x.id===b.getAttribute('data-id'));
          if (p) openDetails(p);
        });
      });
    }
    document.getElementById('btnClearFav').addEventListener('click', ()=>{
      liked.clear();
      localStorage.setItem('localeo_liked', '[]');
      renderFav();
      toast('Favoris vidés');
    });

    // Add listing
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const chooseFiles = document.getElementById('chooseFiles');
    const thumbs = document.getElementById('thumbs');
    const imageCount = document.getElementById('imageCount');
    let selectedImages = [];

    chooseFiles.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', e=> handleFiles(e.target.files));
    ['dragenter','dragover'].forEach(ev=> dropzone.addEventListener(ev, e=>{ e.preventDefault(); dropzone.classList.add('dragover'); }));
    ['dragleave','drop'].forEach(ev=> dropzone.addEventListener(ev, e=>{ e.preventDefault(); dropzone.classList.remove('dragover'); }));
    dropzone.addEventListener('drop', e=> handleFiles(e.dataTransfer.files));
    function handleFiles(list){
      const arr = Array.from(list||[]);
      const remaining = Math.max(0, 3 - selectedImages.length);
      const toRead = arr.slice(0, remaining);
      if (toRead.length < arr.length) toast('Limite 3 images (démo).','err');
      toRead.forEach(f=>{
        const r = new FileReader();
        r.onload = ev=>{ selectedImages.push(ev.target.result); renderThumbs(); };
        r.readAsDataURL(f);
      });
    }
    function renderThumbs(){
      thumbs.innerHTML = '';
      selectedImages.forEach((url, i)=>{
        const div = document.createElement('div');
        div.className = 'relative w-full pt-[66%] rounded-lg overflow-hidden bg-slate-100';
        div.style.backgroundImage = `url('${url}')`;
        div.style.backgroundSize = 'cover';
        div.style.backgroundPosition = 'center';
        const rm = document.createElement('button');
        rm.className = 'absolute top-1 right-1 w-6 h-6 rounded-full bg-white flex items-center justify-center';
        rm.innerHTML = '<svg class="w-4 h-4 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" stroke-linecap="round" d="M6 18L18 6M6 6l12 12"/></svg>';
        rm.addEventListener('click', ()=>{ selectedImages.splice(i,1); renderThumbs(); });
        div.appendChild(rm);
        thumbs.appendChild(div);
      });
      imageCount.textContent = String(selectedImages.length);
    }
    document.getElementById('formAdd').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const p = {
        id:'P'+Date.now(),
        title:(fd.get('title')||'').trim(),
        price:Number(fd.get('price')||0),
        location:(fd.get('location')||'').trim(),
        surface:Number(fd.get('surface')||0),
        ptype:(fd.get('ptype')||'apartment'),
        desc:(fd.get('desc')||'').trim(),
        lat: 46 + (Math.random()*6-3), lng: 2 + (Math.random()*10-5),
        images:[...selectedImages]
      };
      if (!p.title || !p.price || !p.location || !p.surface){ toast('Veuillez remplir les champs.', 'err'); return; }
      props.unshift(p);
      selectedImages = []; renderThumbs(); e.target.reset();
      buildDeck();
      toast('Annonce ajoutée (démo) ✅');
    });

    // Map
    const mapSVG = document.getElementById('mapSVG');
    function project(lng, lat){
      // very rough projection within our blob box:
      const x = (lng + 6) * (360/16); // lng ~ [-6,10]
      const y = (55 - lat) * (260/20); // lat ~ [35,55]
      return [Math.max(8,Math.min(352,x)), Math.max(8,Math.min(252,y))];
    }
    function renderMap(){
      // clear previous markers
      mapSVG.querySelectorAll('.mk').forEach(n=>n.remove());
      const list = applyFilters(props);
      list.forEach(p=>{
        const [x,y] = project(p.lng||2, p.lat||46);
        const g = document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('class','mk');
        g.innerHTML = `<circle cx="${x}" cy="${y}" r="5" fill="#7C3AED"/>
                       <text x="${x+8}" y="${y+4}" font-size="9" fill="#334155">€ ${Number(p.price).toLocaleString('fr-FR')}</text>`;
        g.addEventListener('click', ()=>{
          openDetails(p);
        });
        mapSVG.appendChild(g);
      });
    }

    // Init
    (function init(){
      applyI18n();
      seed();
      if (profile){ showView('swipe'); buildDeck(); } else { showView('onboarding'); }
    })();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98184493e045ba5a',t:'MTc1ODI3NjM2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
